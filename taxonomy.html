<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>AquaIntel ‚Äî Taxonomy & Morphology</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
</head>
<body>
  <div class="nav">
    <div class="nav-inner">
      <div class="brand"><div class="logo"></div><div class="name">AquaIntel</div></div>
      <div><a class="go" href="/">Home</a></div>
    </div>
  </div>

  <div class="page">
    <div class="panel">
      <h2>Taxonomy & Morphology</h2>
      <div id="plot"></div>
    </div>

    <div class="panel">
      <h2>Search species</h2>
      <div class="search-row">
        <input id="q" placeholder="Enter common or scientific name">
        <button class="btn" id="searchBtn">Search</button>
      </div>
      <div id="result" style="margin-top:10px"></div>
    </div>
  </div>

  <div class="footer-space"></div>
  <div class="fab-wrap">
    <button class="fab" onclick="alert('System Alert: Monitor offshore conditions and eDNA updates.')">‚ö†Ô∏è Alert</button>
    <button class="fab" onclick="alert('Chatbot coming soon. Plug any widget/API here.')">üí¨ Chatbot</button>
  </div>

  <script>
    async function fetchJSON(u){const r=await fetch(u);return r.json();}
    function warn(el,msg){el.innerHTML=`<div class='warn'>${msg}</div>`;}
    function render(fig){Plotly.newPlot('plot', fig.data, fig.layout, {responsive:true,displaylogo:false});}
    async function loadViz(){
      const data = await fetchJSON('/treemap?ds='+encodeURIComponent('Taxonomy & Morphology'));
      if(data.error){warn(document.getElementById('plot'), data.error);return;}
      if(!data.data){warn(document.getElementById('plot'), 'No visualization data.');return;}
      render(data);
    }
    async function doSearch(){
      const q = (document.getElementById('q').value||'').trim();
      const res = document.getElementById('result');
      if(!q){warn(res,'Enter a species name.');return;}
      const data = await fetchJSON('/search?ds='+encodeURIComponent('Taxonomy & Morphology')+'&q='+encodeURIComponent(q));
      res.innerHTML = data.html || "<div class='warn'>No result.</div>";
    }
    document.getElementById('searchBtn').addEventListener('click', doSearch);
    document.getElementById('q').addEventListener('keydown', e=>{if(e.key==='Enter') doSearch();});
    loadViz();
  </script>
</body>
</html>
